<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu - Foodie</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <a href="../index.html" class="logo">Foodie</a>
            <div class="search-bar">
                <input type="text" id="menu-search" placeholder="Search for your favorite food...">
            </div>
            <div class="nav-actions">
                <button onclick="toggleTheme()" class="btn" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
                <a href="cart.html" class="cart-icon" aria-label="Cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge cart-count">0</span>
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Page Header -->
        <div style="text-align: center; padding: 50px 0 30px;">
            <h1 style="font-family: 'Playfair Display', serif; font-size: 3rem; margin-bottom: 12px;">
                Our <span style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Menu</span>
            </h1>
            <p style="color: var(--text-muted); font-size: 1.1rem;">Discover delicious dishes from our extensive collection</p>
        </div>

        <div class="menu-layout">
            <!-- Filters Sidebar -->
            <aside class="filters-sidebar">
                <div class="filter-group">
                    <h4>Categories</h4>
                    <div id="category-filters">
                        <!-- Dynamic categories -->
                    </div>
                </div>

                <div class="filter-group">
                    <h4>Food Type</h4>
                    <label class="filter-option">
                        <input type="checkbox" name="type" value="veg" onchange="filterItems()"> 
                        <span>ü•¨ Vegetarian</span>
                    </label>
                    <label class="filter-option">
                        <input type="checkbox" name="type" value="nonveg" onchange="filterItems()"> 
                        <span>üçó Non-Vegetarian</span>
                    </label>
                </div>

                <div class="filter-group">
                    <h4>Price Range</h4>
                    <select id="price-filter" onchange="filterItems()">
                        <option value="all">All Prices</option>
                        <option value="under200">Under ‚Çπ200</option>
                        <option value="200-500">‚Çπ200 - ‚Çπ500</option>
                        <option value="over500">Over ‚Çπ500</option>
                    </select>
                </div>

                <div class="filter-group">
                    <h4>Sort By</h4>
                    <select id="sort-filter" onchange="filterItems()">
                        <option value="default">Default</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                        <option value="name">Name: A to Z</option>
                    </select>
                </div>

                <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="clearFilters()">
                    <i class="fas fa-redo"></i> Clear Filters
                </button>
            </aside>

            <!-- Menu Items -->
            <section>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 id="menu-title" style="font-family: 'Playfair Display', serif; font-size: 1.8rem;">All Dishes</h2>
                    <span id="items-count" style="color: var(--text-muted); font-size: 14px;">0 items</span>
                </div>
                <div class="items-grid" id="menu-container">
                    <!-- Items will be rendered here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4>Foodie</h4>
                    <p>Providing the best food delivery experience since 2026.</p>
                    <div class="social-links">
                        <i class="fab fa-facebook-f"></i>
                        <i class="fab fa-twitter"></i>
                        <i class="fab fa-instagram"></i>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="menu.html">Menu</a></li>
                        <li><a href="cart.html">Cart</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <ul>
                        <li><i class="fas fa-phone"></i> +91 98765 43210</li>
                        <li><i class="fas fa-envelope"></i> hello@foodie.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Foodie. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/storage.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
        let allItems = Storage.getFoodItems();
        let filteredItems = [...allItems];

        document.addEventListener('DOMContentLoaded', () => {
            renderCategoryFilters();
            
            // Handle URL params
            const params = new URLSearchParams(window.location.search);
            const cat = params.get('category');
            const search = params.get('search');
            
            if (cat) {
                document.getElementById('menu-title').textContent = `${cat} Dishes`;
                // Check the category checkbox
                setTimeout(() => {
                    const checkbox = document.querySelector(`input[value="${cat}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                    filterItems();
                }, 100);
            }
            if (search) {
                document.getElementById('menu-search').value = search;
            }

            filterItems();

            // Header scroll effect
            window.addEventListener('scroll', () => {
                const header = document.querySelector('header');
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
        });

        function renderCategoryFilters() {
            const container = document.getElementById('category-filters');
            container.innerHTML = categories.map(cat => `
                <label class="filter-option">
                    <input type="checkbox" name="category" value="${cat.name}" onchange="filterItems()"> 
                    <span>${cat.icon} ${cat.name}</span>
                </label>
            `).join('');
        }

        function filterItems() {
            const searchQuery = document.getElementById('menu-search').value.toLowerCase();
            const selectedCategories = Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value);
            const selectedTypes = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(cb => cb.value);
            const priceRange = document.getElementById('price-filter').value;
            const sortBy = document.getElementById('sort-filter').value;

            filteredItems = allItems.filter(item => {
                const matchesSearch = item.name.toLowerCase().includes(searchQuery) || 
                                     (item.description && item.description.toLowerCase().includes(searchQuery));
                const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(item.category);
                
                let matchesType = true;
                if (selectedTypes.length === 1) {
                    matchesType = selectedTypes[0] === 'veg' ? item.isVeg : !item.isVeg;
                }

                let matchesPrice = true;
                if (priceRange === 'under200') matchesPrice = item.price < 200;
                else if (priceRange === '200-500') matchesPrice = item.price >= 200 && item.price <= 500;
                else if (priceRange === 'over500') matchesPrice = item.price > 500;

                return matchesSearch && matchesCategory && matchesType && matchesPrice;
            });

            // Sort items
            if (sortBy === 'price-low') {
                filteredItems.sort((a, b) => a.price - b.price);
            } else if (sortBy === 'price-high') {
                filteredItems.sort((a, b) => b.price - a.price);
            } else if (sortBy === 'name') {
                filteredItems.sort((a, b) => a.name.localeCompare(b.name));
            }

            // Update title based on filters
            if (selectedCategories.length === 1) {
                document.getElementById('menu-title').textContent = `${selectedCategories[0]} Dishes`;
            } else if (selectedCategories.length > 1) {
                document.getElementById('menu-title').textContent = 'Selected Categories';
            } else {
                document.getElementById('menu-title').textContent = 'All Dishes';
            }

            renderMenu();
        }

        function renderMenu() {
            const container = document.getElementById('menu-container');
            document.getElementById('items-count').textContent = `${filteredItems.length} items`;

            if (filteredItems.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 80px 20px;">
                        <div style="font-size: 80px; margin-bottom: 20px;">üçΩÔ∏è</div>
                        <h3 style="font-size: 1.5rem; margin-bottom: 12px;">No dishes found</h3>
                        <p style="color: var(--text-muted);">Try adjusting your filters or search for something else</p>
                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="clearFilters()">
                            <i class="fas fa-redo"></i> Clear Filters
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredItems.map((food, index) => `
                <div class="card" style="animation-delay: ${index * 0.05}s">
                    <div class="card-img-wrapper">
                        <img src="${food.image}" class="card-img" alt="${food.name}" loading="lazy">
                        <span class="card-badge ${food.isVeg ? 'veg-label' : 'non-veg-label'}">
                            ${food.isVeg ? 'Veg' : 'Non-Veg'}
                        </span>
                        <span class="card-favorite" onclick="toggleFavorite(${food.id}, this)">
                            <i class="far fa-heart"></i>
                        </span>
                    </div>
                    <div class="card-content">
                        <div class="card-title">${food.name}</div>
                        <p class="card-description">${food.description || 'Freshly prepared with love'}</p>
                        <div class="card-info">
                            <span style="display: flex; align-items: center; gap: 4px;">
                                <i class="fas fa-tag" style="color: var(--primary-color);"></i>
                                ${food.category}
                            </span>
                        </div>
                        <div class="price-row">
                            <span class="price">‚Çπ${food.price}</span>
                            <button class="btn btn-primary" onclick="addToCart(${food.id})">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const food = allItems.find(f => f.id === id);
            Storage.addToCart(food);
            showToast('Added to cart!', 'success');
            
            // Animate cart icon
            const cartIcon = document.querySelector('.cart-icon');
            cartIcon.style.transform = 'scale(1.2)';
            setTimeout(() => {
                cartIcon.style.transform = 'scale(1)';
            }, 200);
        }

        function toggleFavorite(id, element) {
            const icon = element.querySelector('i');
            if (icon.classList.contains('far')) {
                icon.classList.remove('far');
                icon.classList.add('fas');
                icon.style.color = '#ff6b6b';
                showToast('Added to favorites!', 'success');
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
                icon.style.color = '';
                showToast('Removed from favorites', 'danger');
            }
        }

        function clearFilters() {
            // Clear all checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            // Reset selects
            document.getElementById('price-filter').value = 'all';
            document.getElementById('sort-filter').value = 'default';
            // Clear search
            document.getElementById('menu-search').value = '';
            // Reset title
            document.getElementById('menu-title').textContent = 'All Dishes';
            // Re-filter
            filterItems();
        }

        // Real-time search with debounce
        let searchTimeout;
        document.getElementById('menu-search').addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(filterItems, 300);
        });
    </script>
</body>
</html>
